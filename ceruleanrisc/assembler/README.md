# CeruleanRISC Assembler

The CeruleanRISC Assembler is a low-level assembler for converting CeruleanRISC assembly programs to
CeruleanRISC object code. Object code files can then be linked together using the CeruleanRISC linker
to produce executable bytecode files which can be run on the CeruleanRISC virtual machine.

## Overview

**CeruleanRISC (CRISC)** is a 32-bit fixed-width RISC-like ISA with 64-bit registers. The assembler converts
human-readable assembly code (`.crisc` files) into relocatable object files (`.crisco` files).

# Assembling a program

To assemble a program, run the assembler with your assembly file:
```bash
python3 -m ceruleanrisc.assembler.assembler <INPUT_ASM_FILE> -o <OUTPUT_OBJ_FILE>
```

Example assembling the provided simple helloworld program:
```bash
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/helloworld.crisc -o ceruleanrisc/assembler/test_files/helloworld.crisco --debug --emitTokens --emitAST
```

This creates a CeruleanRISC object code file which can then be passed to the CeruleanRISC linker to generate the final runnable bytecode file:
```bash
python3 -m ceruleanrisc.linker.linker ceruleanrisc/assembler/test_files/helloworld.crisco -o ceruleanrisc/assembler/test_files/helloworld.criscbc --debug
```

You can examine the generated bytecode with hexdump:
```bash
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanrisc/assembler/test_files/helloworld.criscbc
```
This specific command will print 4-bytes per line which aligns with the static 4-byte width of each CeruleanRISC instruction.

Running generated bytecode with the CeruleanRISC VM:
```bash
ceruleanrisc/vm/build/criscvm ceruleanrisc/assembler/test_files/helloworld.criscbc
```

## More examples
### Hello World 2: data directives
```bash
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/helloworld2.crisc -o ceruleanrisc/assembler/test_files/helloworld2.crisco --debug --emitTokens --emitAST
python3 -m ceruleanrisc.linker.linker ceruleanrisc/assembler/test_files/helloworld2.crisco -o ceruleanrisc/assembler/test_files/helloworld2.criscbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanrisc/assembler/test_files/helloworld2.criscbc
ceruleanrisc/vm/build/criscvm ceruleanrisc/assembler/test_files/helloworld2.criscbc
```

### Hello World 3: branching/loops
```bash
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/helloworld3.crisc -o ceruleanrisc/assembler/test_files/helloworld3.crisco --debug --emitTokens --emitAST
python3 -m ceruleanrisc.linker.linker ceruleanrisc/assembler/test_files/helloworld3.crisco -o ceruleanrisc/assembler/test_files/helloworld3.criscbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanrisc/assembler/test_files/helloworld3.criscbc
ceruleanrisc/vm/build/criscvm ceruleanrisc/assembler/test_files/helloworld3.criscbc
```

### Hello World 4: function calls, stack push and pop
```bash
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/helloworld4.crisc -o ceruleanrisc/assembler/test_files/helloworld4.crisco --debug --emitTokens --emitAST
python3 -m ceruleanrisc.linker.linker ceruleanrisc/assembler/test_files/helloworld4.crisco -o ceruleanrisc/assembler/test_files/helloworld4.criscbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanrisc/assembler/test_files/helloworld4.criscbc
ceruleanrisc/vm/build/criscvm ceruleanrisc/assembler/test_files/helloworld4.criscbc
```

### Hello World 5: multi-file
```bash
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/helloworld5.crisc -o ceruleanrisc/assembler/test_files/helloworld5.crisco --debug --emitTokens --emitAST
python3 -m ceruleanrisc.assembler.assembler ceruleanrisc/assembler/test_files/print_string.crisc -o ceruleanrisc/assembler/test_files/print_string.crisco --debug --emitTokens --emitAST
python3 -m ceruleanrisc.linker.linker ceruleanrisc/assembler/test_files/print_string.crisco ceruleanrisc/assembler/test_files/helloworld5.crisco -o ceruleanrisc/assembler/test_files/helloworld5.criscbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanrisc/assembler/test_files/helloworld5.criscbc
ceruleanrisc/vm/build/criscvm ceruleanrisc/assembler/test_files/helloworld5.criscbc
```

# Unit testing

CeruleanRISC assembler unit tests use the python unittest package. The following command can run all of the tests for the assembler.
```bash
python3 -m unittest discover -s ceruleanrisc/assembler/unittests -p "test_*.py" -v
```
