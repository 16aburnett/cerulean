# CeruleanASM Assembler

CeruleanASM Assembler is a low-level assembler for converting a CeruleanASM-language program to
CeruleanObjectCode. CeruleanObjectCode files can then be linked together using the CeruleanLinker
to a CeruleanByteCode file which can then be ran via the CeruleanVM iterpreter.

# Assembling a program

To assemble a program, run the assembler with your ASM file like below:
```bash
python3 -m ceruleanasm.assembler <INPUT_ASM_FILE> -o <OUTPUT_OBJ_FILE>
```

Example assembling the provided simple helloworld program:
```bash
python3 -m ceruleanasm.assembler ceruleanasm/test_files/helloworld.ceruleanasm -o ceruleanasm/test_files/helloworld.ceruleanobj --debug --emitTokens --emitAST
```

This creates an CeruleanObj object code file which can then be passed to the CeruleanLD linker to generate the final runnable bytecode file:
```bash
python3 -m ceruleanld.linker ceruleanasm/test_files/helloworld.ceruleanobj -o ceruleanasm/test_files/helloworld.ceruleanbc --debug
```

You can examine the generated bytecode with hexdump:
```bash
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanasm/test_files/helloworld.ceruleanbc
```
This specific command will print 4-bytes per line which aligns with the static 4-byte width of each instruction.

Running generated bytecode with the CeruleanVM:
```bash
ceruleanvm/build/ceruleanvm ceruleanasm/test_files/helloworld.ceruleanbc
```

## More examples
### Hello World 2: data directives
```bash
python3 -m ceruleanasm.assembler ceruleanasm/test_files/helloworld2.ceruleanasm -o ceruleanasm/test_files/helloworld2.ceruleanobj --debug --emitTokens --emitAST
python3 -m ceruleanld.linker ceruleanasm/test_files/helloworld2.ceruleanobj -o ceruleanasm/test_files/helloworld2.ceruleanbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanasm/test_files/helloworld2.ceruleanbc
ceruleanvm/build/ceruleanvm ceruleanasm/test_files/helloworld2.ceruleanbc
```

### Hello World 3: branching/loops
```bash
python3 -m ceruleanasm.assembler ceruleanasm/test_files/helloworld3.ceruleanasm -o ceruleanasm/test_files/helloworld3.ceruleanobj --debug --emitTokens --emitAST
python3 -m ceruleanld.linker ceruleanasm/test_files/helloworld3.ceruleanobj -o ceruleanasm/test_files/helloworld3.ceruleanbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanasm/test_files/helloworld3.ceruleanbc
ceruleanvm/build/ceruleanvm ceruleanasm/test_files/helloworld3.ceruleanbc
```

### Hello World 4: function calls, stack push and pop
```bash
python3 -m ceruleanasm.assembler ceruleanasm/test_files/helloworld4.ceruleanasm -o ceruleanasm/test_files/helloworld4.ceruleanobj --debug --emitTokens --emitAST
python3 -m ceruleanld.linker ceruleanasm/test_files/helloworld4.ceruleanobj -o ceruleanasm/test_files/helloworld4.ceruleanbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanasm/test_files/helloworld4.ceruleanbc
ceruleanvm/build/ceruleanvm ceruleanasm/test_files/helloworld4.ceruleanbc
```

### Hello World 5: multi-file
```bash
python3 -m ceruleanasm.assembler ceruleanasm/test_files/helloworld5.ceruleanasm -o ceruleanasm/test_files/helloworld5.ceruleanobj --debug --emitTokens --emitAST
python3 -m ceruleanasm.assembler ceruleanasm/test_files/print_string.ceruleanasm -o ceruleanasm/test_files/print_string.ceruleanobj --debug --emitTokens --emitAST
python3 -m ceruleanld.linker ceruleanasm/test_files/print_string.ceruleanobj ceruleanasm/test_files/helloworld5.ceruleanobj -o ceruleanasm/test_files/helloworld5.ceruleanbc --debug
hexdump -v -e '"%08_ax " 4/1 "%02x " "\n"' ceruleanasm/test_files/helloworld5.ceruleanbc
ceruleanvm/build/ceruleanvm ceruleanasm/test_files/helloworld5.ceruleanbc
```

# Unit testing

CeruleanASM unit tests use the python unittest package. The following command can run all of the tests for CeruleanASM.
```bash
python3 -m unittest discover -s ceruleanasm/unittests -p "test_*.py"
```
